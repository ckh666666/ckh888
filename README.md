# 台湾2024年大选选情分析系统

## 📋 项目概述

这是一个基于Web技术的台湾2024年总统大选选情分析可视化系统，提供多维度、交互式的选举数据分析和展示功能。系统采用现代化的前端技术栈，支持实时数据更新和多种分析模式。

## 🎯 核心功能

### 1. 多党派得票分析
- **中国国民党 (KMT)** - 蓝色系可视化
- **民主进步党 (DPP)** - 绿色系可视化  
- **台湾民众党 (TPP)** - 青绿色系可视化
- **获胜党派分析** - 胜率模式与党派模式切换

### 2. 获胜党派双模式分析
- **胜率模式**: 显示各地区的获胜党得票率，使用金色渐变
- **党派模式**: 按获胜党派显示不同颜色，隐藏图例信息

### 3. 大罢免数据分析
- 支持多个县市的罢免案分析
- 立委级别的详细数据展示
- 投票率与同意率统计

### 4. 区域获胜党票数排行
- 按获胜党票数进行地区排行
- 不同党派使用不同颜色系列
- 票数分级可视化

### 5. 地区详细分析
- 支持点击进入各县市详细地图
- 地区内部投票数据展示
- 立委选举结果分析

## 🏗️ 技术架构

### 前端技术栈
- **HTML5** - 页面结构
- **CSS3** - 样式设计，响应式布局
- **JavaScript ES6+** - 交互逻辑
- **D3.js v7** - 数据可视化核心库
- **TopoJSON** - 地理数据处理

### 核心模块
```
├── election-data.js          # 选举数据核心处理
├── taiwan-map.js            # 台湾地图渲染
├── district-map.js          # 地区地图处理
├── winner-ranking.js        # 获胜党排行功能
├── district-winner-ranking.js # 地区获胜党排行
├── recall-framework.js      # 大罢免分析框架
└── district-config.js       # 地区配置管理
```

### 数据文件结构
```
├── 各县市真实数据文件 (*-real-data.js)
├── 各县市罢免数据文件 (*-recall-data.js)
├── 地区获胜党数据文件 (*-district-winner-data.js)
└── counties.json           # 地理边界数据
```

## 📊 数据来源

- **选举数据**: 中华民国中央选举委员会官方数据
- **地理数据**: 台湾行政区划边界数据
- **罢免数据**: 各地方选举委员会公开数据
- **数据采集时间**: 2024年1月

## 🚀 功能特色

### 1. 智能图例管理
- 自动根据当前模式显示/隐藏图例
- 党派模式下完全隐藏图例信息
- 动态更新图例标签和颜色

### 2. 交互式地图操作
- 支持地图缩放和平移
- 鼠标悬停显示详细数据
- 点击进入地区详细视图

### 3. 多维度数据展示
- 全台统计数据面板
- 地区排行榜动态更新
- 县市详情实时显示
- 得票分析图表生成

### 4. 响应式设计
- 适配不同屏幕尺寸
- 移动端友好的交互设计
- 流畅的动画过渡效果

## 🎮 使用指南

### 基本操作
1. **选择党派**: 点击上方的党派按钮切换不同政党的得票分析
2. **获胜党派模式**: 选择"获胜党派"后可使用胜率/党派模式切换
3. **地区分析**: 点击地图上的县市进入详细分析
4. **大罢免分析**: 选择"大罢免分析"查看罢免相关数据

### 高级功能
- **地图缩放**: 使用 +/- 按钮或鼠标滚轮缩放地图
- **地区导航**: 在地区视图中使用返回按钮回到全台视图
- **立委选择**: 在大罢免模式下可选择特定立委查看详细数据

## 🔧 技术实现细节

### 图例隐藏机制
```javascript
// 党派模式下的图例隐藏逻辑
if (currentParty === 'winner' && currentWinnerMode === 'party') {
    legendContainer.style.display = 'none';
    return;
}
```

### 数据更新机制
```javascript
// 智能排行榜更新
function updateRankingDisplaySmart() {
    if (window.districtMapState && window.districtMapState.currentView === 'district') {
        // 地区视图更新
        window.updateDistrictRankingForPartySwitch();
    } else {
        // 全台视图更新
        updateRankingDisplay();
    }
}
```

### 颜色配置系统
```javascript
const partyConfig = {
    kmt: { colors: ['#E3F2FD', '#BBDEFB', '#90CAF9', '#64B5F6', '#42A5F5', '#2196F3'] },
    dpp: { colors: ['#E8F5E8', '#C8E6C9', '#A5D6A7', '#81C784', '#66BB6A', '#4CAF50'] },
    tpp: { colors: ['#E0F2F1', '#B2DFDB', '#80CBC4', '#4DB6AC', '#26A69A', '#00897B'] }
};
```

## 📈 性能优化

### 数据加载优化
- 异步加载地理数据
- 按需加载地区详细数据
- 缓存已加载的数据

### 渲染性能优化
- 使用D3.js的过渡动画
- 优化地图渲染性能
- 减少DOM操作频率

### 内存管理
- 及时清理事件监听器
- 优化大数据集的处理
- 避免内存泄漏

## 🐛 已知问题与解决方案

### 图例显示异常
**问题**: 从其他功能切换到胜率模式的党派模式时，图例信息显示异常
**解决方案**: 已在多个关键位置添加图例隐藏逻辑
- `switchParty()` 函数中添加党派模式检查
- `updateWinnerMode()` 函数中确保党派模式图例隐藏
- `updateDistrictLegendLabels()` 函数中加强隐藏逻辑

### 地区切换问题
**问题**: 在地区视图下切换党派时可能出现显示异常
**解决方案**: 实现了智能更新机制，根据当前视图状态调用相应的更新函数

## 🔮 未来规划

### 功能扩展
- [ ] 添加更多历史选举数据对比
- [ ] 支持更多选举类型分析
- [ ] 增加数据导出功能
- [ ] 添加用户自定义分析功能

### 技术改进
- [ ] 升级到D3.js最新版本
- [ ] 优化移动端体验
- [ ] 添加PWA支持
- [ ] 实现服务端渲染

### 数据增强
- [ ] 添加更多选举指标
- [ ] 支持实时数据更新
- [ ] 增加预测分析功能
- [ ] 添加数据可视化模板

## 📄 许可证

本项目仅供学术研究使用，数据来源为中华民国中央选举委员会公开数据。

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这个项目。在贡献代码前，请确保：

1. 代码符合项目规范
2. 添加必要的注释和文档
3. 测试新功能是否正常工作
4. 更新相关文档

## 📞 联系方式

如有问题或建议，请通过以下方式联系：

- 提交GitHub Issue
- 发送邮件至项目维护者
- 参与项目讨论

---

**最后更新**: 2024年1月  
**版本**: 1.0.0  
**维护者**: 异步图书团队 